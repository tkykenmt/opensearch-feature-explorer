# OpenSearch 3.0.0 リリース分析

## 概要

OpenSearch 3.0.0は、パフォーマンス、データ管理、セキュリティ、ベクトルデータベース機能などの大幅なアップグレードを提供するメジャーリリースです。このリリースには、破壊的変更、新機能、実験的機能が含まれています。

**リリース日:** 2025年4月28日

## 主なハイライト

### パフォーマンス改善

| 機能 | 改善 | 詳細 |
|------|------|------|
| 範囲クエリ | 25%高速化 | 数値・日付フィールドへのスマートな戦略でI/O操作を削減 |
| 高カーディナリティクエリ | p90レイテンシ75%削減 | カーディナリティ集計の実行ヒント |
| 並行セグメント検索 (k-NN) | 最大2.5倍高速化 | デフォルトで有効、テールレイテンシ20%改善 |
| k-NN派生ソース | 最大30倍改善 | コールドスタートクエリレイテンシ、ストレージ3倍削減 |
| Star-Treeインデックス | 最大100倍削減 | メトリック集計とフィルタ付きtermsクエリの処理負荷 |

### 新機能

#### 検索・クエリ機能強化
- **セマンティック文ハイライト**: キーワードだけでなく意味に基づくコンテキスト認識ハイライト
- **Zスコア正規化**: ハイブリッド検索スコア正規化の新しい統計的アプローチ
- **下限付きMin-Max正規化**: ハイブリッド検索での低スコアの過剰増幅を防止
- **Inner Hitsサポート**: ハイブリッドクエリでのネストまたは親子結合フィールドの詳細な可視性
- **PPL機能強化**: Apache Calciteを基盤とした新しいlookup、join、subsearchコマンド

#### ベクトル検索 (k-NN)
- **Faiss用Explainパラメータ**: k-NNクエリスコアリングプロセスの詳細な洞察
- **ノードレベルサーキットブレーカー**: 混合ハードウェア環境向けの異種サーキットブレーカー制限
- **メモリ最適化検索モード**: メモリ制約環境でのベクトル検索実行

#### データ管理
- **プルベースインジェスト**: Apache KafkaとAmazon Kinesisから直接データを取得
- **ゼロへのスケール**: 読み取り負荷の高いワークロード向けに`_scale` APIでインデックスと検索トラフィックを分離
- **Star-Treeインデックス拡張**: メトリック集計とフィルタ付きtermsクエリのサポート

#### セキュリティ
- **新セキュリティフレームワーク**: Java Security ManagerをJavaエージェントで置き換え
- **最適化された権限評価**: Securityプラグインでのシリアライゼーションオーバーヘッド削減
- **新PGPキー**: アーティファクト検証の更新（2027年3月6日まで有効）

#### 可観測性・監視
- **Query Insights改善**: ライブクエリAPI、verboseパラメータ、動的カラム
- **コンテキスト異常検出**: ダッシュボードから異常検出器を起動し、関連ログを自動入力

### 実験的機能

| 機能 | 説明 |
|------|------|
| GPU高速化 | インデックス作成最大9.3倍高速化、CPUと比較してコスト3.75倍削減 |
| gRPCトランスポート | gRPC上のProtocol Buffersでシリアライゼーションオーバーヘッド削減 |
| プルベースインジェスト | Kafka/Kinesisからのネイティブバックプレッシャー処理 |
| MCPサポート | AIエージェント統合のためのModel Context Protocol |
| Plan-Execute-Reflectエージェント | 複雑なタスクの自律的問題解決 |

## 破壊的変更

### コア変更
- **Lucene 10.1.0アップグレード**: 検索エンジンのメジャーアップグレード
- **JDK 21最小要件**: 必須Javaランタイムバージョン
- **BM25スコアリングデフォルト**: LegacyBM25SimilarityからBM25Similarityに変更
- **Apache HttpClient 5.x**: クライアントトランスポートの移行

### API変更
- `_bulk`から非推奨の`batch_size`パラメータを削除
- `_cat/shards`アクションに`cluster:monitor/shards`権限を追加
- Bulk Index APIで512バイトの`_id`サイズ制限を適用
- ネストクエリの最大深度設定

### 削除された機能
- Java Security Manager（Javaエージェントで置き換え）
- transport-nioプラグイン
- COMPATロケールプロバイダー
- mmap.extensions設定
- 各種非推奨スレッドプール設定

### プラグイン固有の破壊的変更

#### k-NN
- インデックス設定から`ef_construction`、`m`、`space_type`を削除
- KNNプラグイン有効化設定を削除

#### SQL
- SparkSQLサポートを削除
- opendistro設定とエンドポイントを削除
- SQL Delete文とscroll API使用を非推奨化

#### Security
- OpenSSLプロバイダーを削除
- whitelist設定を削除（allowlistを使用）

## 非推奨通知

- **Ubuntu Linux 20.04**: サポートは非推奨予定（2025年4月EOL）
- **Dashboards上のAmazon Linux 2**: Node.js 18 EOLによりサポートは非推奨予定

## OpenSearch Dashboards 3.0.0

### 破壊的変更
- `CssDistFilename`を削除
- `HttpFetchOptions`の`withLongNumerals`を削除
- `@elastic/filesaver`を削除
- `monaco-editor`を0.52.0にバンプ
- Discoverの非推奨「newExperience」テーブルオプションを削除

### 新機能
- オートコンプリート値サジェスト
- DiscoverページからのCSVエクスポート
- Discoverページのスクロール体験改善
- イベントストリームコンテンツタイプのストリーミングサポート
- msearchのMDSサポート

## 移行時の考慮事項

### アップグレード前
1. JDK 21がインストールされていることを確認
2. 非推奨APIの使用を確認・更新
3. k-NNインデックス設定を更新（非推奨パラメータを削除）
4. Securityでwhitelistからallowlist設定に移行
5. アーティファクト検証用のPGPキーを更新

### 互換性に関する注意
- プラグインはLucene 10.1.0互換性のために更新が必要
- 非推奨のJodaCompatibleZonedDateTimeメソッドを使用するカスタムスクリプトは更新が必要
- セキュリティポリシーはJSMからJavaエージェント形式への移行が必要

## リソース

- [完全なリリースノート](https://github.com/opensearch-project/opensearch-build/blob/main/release-notes/opensearch-release-notes-3.0.0.md)
- [破壊的変更メタイシュー](https://github.com/opensearch-project/opensearch-build/issues/5243)
- [OpenSearch 3.0.0アーティファクト](https://opensearch.org/artifacts/by-version/#release-3-0-0)
- [署名の検証](https://opensearch.org/verify-signatures.html)
